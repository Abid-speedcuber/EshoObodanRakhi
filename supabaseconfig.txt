â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    SUPABASE CONFIGURATION DOCUMENTATION                    â•‘
â•‘                         Esho Obodan Rakhi Fund App                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ PROJECT OVERVIEW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Project: Community Fund & Blood Donation Management System
Database: PostgreSQL (Supabase)
Authentication: Supabase Auth (Email/Password + Google OAuth)
Storage: Supabase Storage (for images)
Real-time: Supabase Realtime (for live updates)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ—„ï¸ DATABASE SCHEMA - PUBLIC TABLES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TABLE: public.users                                                     â”‚
â”‚ Purpose: Store user profiles and roles                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Columns:
  âœ“ id (UUID, PRIMARY KEY) â†’ References auth.users(id) ON DELETE CASCADE
  âœ“ name (TEXT, NOT NULL) â†’ User's full name
  âœ“ email (TEXT) â†’ User's email address
  âœ“ role (TEXT, DEFAULT 'user') â†’ User role: 'user', 'student', 'moderator', 'admin'
  âœ“ created_at (TIMESTAMP, DEFAULT now())

RLS Policies (Enabled: âœ…):
  1. SELECT: "User Can Read Their Own Data and admin can read all data"
     â†’ Target: authenticated
     â†’ Rule: (auth.uid() = id) OR is_admin()
     
  2. INSERT: "Users can create their own profile"
     â†’ Target: public
     â†’ Rule: true
     
  3. UPDATE: "Admin Can Update Any User's Role"
     â†’ Target: authenticated
     â†’ Rule: EXISTS (SELECT 1 FROM users WHERE id = auth.uid() AND role = 'admin')

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TABLE: public.fund                                                      â”‚
â”‚ Purpose: Track all income (collection) and expenses (sadakah)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Columns:
  âœ“ id (BIGSERIAL, PRIMARY KEY)
  âœ“ month (TEXT, NOT NULL) â†’ Format: "YYYY-MM" (e.g., "2017-06")
  âœ“ type (TEXT, NOT NULL) â†’ 'income' or 'expense'
  âœ“ name (TEXT) â†’ Donor name (for income entries)
  âœ“ description (TEXT) â†’ Sadakah title (for expense entries)
  âœ“ additional_info (TEXT) â†’ Optional details for expenses
  âœ“ amount (NUMERIC, NOT NULL) â†’ Amount in local currency
  âœ“ highlighted (BOOLEAN, DEFAULT false) â†’ If true, shows in red
  âœ“ is_display (BOOLEAN, DEFAULT NULL) â†’ **INVERSE LOGIC**: NULL/false = show in Sadakah tab, true = hide from Sadakah tab
  âœ“ is_calculation (BOOLEAN, DEFAULT NULL) â†’ **INVERSE LOGIC**: NULL/false = include in calculations & Collection tab, true = exclude
  âœ“ timestamp (TIMESTAMP, DEFAULT now())
  âœ“ updated_by (UUID) â†’ References auth.users(id)

Sadakah Display Logic (Non-Admin Users):
  â†’ Collection Tab (Expense Section): Shows only is_calculation=true (NULL/false in DB)
  â†’ Sadakah Tab: Shows only is_display=true (NULL/false in DB)
  â†’ Admin View: Shows ALL sadakah entries regardless of flags
  
Sadakah Categories by Flags:
  1. is_display=true, is_calculation=true (NULL, NULL): Regular sadakah - shows everywhere
  2. is_display=true, is_calculation=false (NULL, true): Dedicated fundraiser donations - show in Sadakah tab only
  3. is_display=false, is_calculation=true (true, NULL): Maintenance/operational expenses - show in Collection tab only
  4. is_display=false, is_calculation=false (true, true): Planned sadakah - hidden from both tabs (admin only)

Tab Calculations:
  â†’ Sadakah Tab Total: Sum of all is_display=true entries (regardless of is_calculation)
  â†’ "From Fund" Amount: Sum of all is_calculation=true entries (regardless of is_display)
  â†’ Complete History Modal: Shows only is_calculation=true entries

RLS Policies (Enabled: âœ…):
  1. SELECT: "EveryoneCanSeeFund"
     â†’ Target: public
     â†’ Rule: true
     
  2. INSERT: "Only admins can add fund"
     â†’ Target: authenticated
     â†’ Rule: auth.uid() IN (SELECT id FROM users WHERE role = 'admin')
     
  3. UPDATE: "Only admin can update fund"
     â†’ Target: authenticated
     â†’ Rule: auth.uid() IN (SELECT id FROM users WHERE role = 'admin')
     
  4. DELETE: "Only admins delete fund"
     â†’ Target: authenticated
     â†’ Rule: auth.uid() IN (SELECT id FROM users WHERE role = 'admin')

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TABLE: public.donors                                                    â”‚
â”‚ Purpose: Blood donor directory with contact info and availability      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Columns:
  âœ“ id (BIGSERIAL, PRIMARY KEY)
  âœ“ user_id (UUID, UNIQUE) â†’ References auth.users(id) ON DELETE CASCADE
  âœ“ name (TEXT, NOT NULL)
  âœ“ phone (TEXT, NOT NULL)
  âœ“ blood_group (TEXT, NOT NULL) â†’ 'A+', 'A-', 'B+', 'B-', 'O+', 'O-', 'AB+', 'AB-'
  âœ“ location (TEXT, NOT NULL)
  âœ“ available (BOOLEAN, DEFAULT true)
  âœ“ last_donated (DATE) â†’ Date of last blood donation (NULL if never donated or not tracked)
  âœ“ created_by_admin (BOOLEAN, DEFAULT false) â†’ True if admin added profile
  âœ“ created_at (TIMESTAMP, DEFAULT now())

Availability Logic:
  â†’ If last_donated is within 100 days from today: Force unavailable (overrides available toggle)
  â†’ Otherwise: Use available toggle value
  â†’ Display: Show "Last donated: [date]" on card if last_donated is set
  â†’ Admins: Can set/change last_donated for any profile
  â†’ Users: Can set/change their own last_donated

RLS Policies (Enabled: âœ…):
  1. SELECT: "EveryoneCanSeeDonorData"
     â†’ Target: public
     â†’ Rule: true
     
  2. INSERT: "UserCanCreateOwnDonorProfile"
     â†’ Target: authenticated
     â†’ Rule: (auth.uid() = user_id) OR (is_admin() AND user_id IS NULL)
     
  3. INSERT: "Admins can create donor profile"
     â†’ Target: authenticated
     â†’ Rule: is_admin() OR (auth.uid() = user_id)
     
  4. UPDATE: "UserCanUpdateOwnProfile"
     â†’ Target: authenticated
     â†’ Rule: auth.uid() = user_id
     
  5. UPDATE: "Admins can update any donor profile"
     â†’ Target: authenticated
     â†’ Rule: is_admin()
     
  6. DELETE: "Users can delete own profile"
     â†’ Target: authenticated
     â†’ Rule: auth.uid() = user_id
     
  7. DELETE: "Admins can delete any donor profile"
     â†’ Target: authenticated
     â†’ Rule: is_admin()

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TABLE: public.notices                                                   â”‚
â”‚ Purpose: Community activity feed / announcements                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Columns:
  âœ” id (BIGSERIAL, PRIMARY KEY)
  âœ” text (TEXT) â†’ Activity description
  âœ” author_name (TEXT) â†’ Name of person who posted
  âœ” author_id (UUID) â†’ References auth.users(id)
  âœ” image_url (TEXT) â†’ Optional image attachment
  âœ” timestamp (TIMESTAMP, DEFAULT now())

RLS Policies (Enabled: âœ…):
  1. SELECT: "Everyone can see notices"
     â†’ Target: public
     â†’ Rule: true
     
  2. INSERT: "Admin can post notices"
     â†’ Target: authenticated
     â†’ Rule: auth.uid() IN (SELECT id FROM users WHERE role = 'admin')
     
  3. UPDATE: "Admin can update notices"
     â†’ Target: authenticated
     â†’ Rule: is_admin()
     
  4. DELETE: "Admin can delete notices"
     â†’ Target: authenticated
     â†’ Rule: is_admin()

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TABLE: public.notifications                                               â”‚
â”‚ Purpose: System notifications for users (targeted by role)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Columns:
  âœ“ id (BIGSERIAL, PRIMARY KEY)
  âœ“ title (TEXT, NOT NULL) â†’ Notification title/heading
  âœ“ content (TEXT, NOT NULL) â†’ Notification message body
  âœ“ target_audience (TEXT, NOT NULL) â†’ 'all' or 'student'
      CHECK constraint: target_audience IN ('all', 'student')
  âœ“ created_by (UUID, NOT NULL) â†’ References auth.users(id) ON DELETE CASCADE
  âœ“ created_at (TIMESTAMP, DEFAULT now())

RLS Policies (Enabled: âœ…):
  1. SELECT: "Users can see notifications for their audience"
     â†’ Target: public
     â†’ Rule: target_audience = 'all' OR (target_audience = 'student' AND 
             auth.uid() IN (SELECT id FROM users WHERE role IN ('student', 'admin', 'moderator')))
     
  2. INSERT: "Admin and moderators can create notifications"
     â†’ Target: authenticated
     â†’ Rule: auth.uid() IN (SELECT id FROM users WHERE role IN ('admin', 'moderator'))
     
  3. UPDATE: "Admin and moderators can update notifications"
     â†’ Target: authenticated
     â†’ Rule: auth.uid() IN (SELECT id FROM users WHERE role IN ('admin', 'moderator'))
     
  4. DELETE: "Admin and moderators can delete notifications"
     â†’ Target: authenticated
     â†’ Rule: auth.uid() IN (SELECT id FROM users WHERE role IN ('admin', 'moderator'))

Notification Visibility Rules:
  â†’ Regular Users: See only 'all' targeted notifications
  â†’ Students: See 'all' + 'student' targeted notifications
  â†’ Admins/Moderators: See ALL notifications (both 'all' and 'student')

Management Permissions:
  â†’ Admin: Can create, edit, bump, and delete ALL notifications
  â†’ Moderator: Can create, edit, bump, and delete ALL notifications
  â†’ Students/Users: Read-only access based on target audience

UI Locations:
  â†’ Regular Users: Top bar notification icon (bell icon)
  â†’ Students: Talib Menu â†’ Notifications button
  â†’ Admins: Admin Menu â†’ Notifications button
  â†’ Moderators: (Future) Moderator Menu â†’ Notifications button

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TABLE: public.notes                                                    â”‚
â”‚ Purpose: Personal notes for students, moderators, and admins           â”‚
â”‚ SPECIAL: Offline-first design with localStorage + cloud sync           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Columns:
  âœ“ id (UUID, PRIMARY KEY) â†’ Client-generated UUID for offline support
  âœ“ user_id (UUID, NOT NULL) â†’ References auth.users(id) ON DELETE CASCADE
  âœ“ title (TEXT) â†’ Note title (optional, falls back to first 3 words)
  âœ“ content (TEXT, NOT NULL) â†’ Main note content with inline formatting:
      **text** = bold
      ++text++ = highlighted (red)
      +*text*+ = bold + highlighted
  âœ“ datestamp (DATE, NOT NULL) â†’ User-selected date (not auto-generated)
  âœ“ created_at (TIMESTAMP, DEFAULT now())
  âœ“ updated_at (TIMESTAMP, DEFAULT now())

RLS Policies (Enabled: âœ…):
  1. SELECT: "Users can read their own notes"
     â†’ Target: authenticated
     â†’ Rule: auth.uid() = user_id
     
  2. SELECT: "Admins can read all notes" âš ï¸ DATABASE ONLY - NOT USED IN APP
     â†’ Target: authenticated
     â†’ Rule: EXISTS (SELECT 1 FROM users WHERE id = auth.uid() AND role = 'admin')
     â†’ Note: This policy exists for database flexibility but the app NEVER uses it.
              Admins only see their OWN notes, respecting user privacy.
     
  3. INSERT: "Users can insert their own notes"
     â†’ Target: authenticated
     â†’ Rule: auth.uid() = user_id
     
  4. UPDATE: "Users can update their own notes"
     â†’ Target: authenticated
     â†’ Rule: auth.uid() = user_id
     
  5. DELETE: "Users can delete their own notes"
     â†’ Target: authenticated
     â†’ Rule: auth.uid() = user_id

Offline-First Architecture:
  â†’ Primary storage: localStorage (key: `notes_{userId}`)
  â†’ Cloud backup: Supabase (manual via "Backup to Cloud" button)
  â†’ Sync strategy: Local overrides server on backup
  â†’ Conflict resolution: Local version always wins
  â†’ Auto-sync: On app initialization (downloads from server)
  â†’ Merge logic: Keep local notes + add server notes not in local

Access Control:
  â†’ Admin: Full access to notes feature (sees ONLY their own notes)
  â†’ Student: Full access to notes feature (sees ONLY their own notes)
  â†’ Moderator: Full access to notes feature (sees ONLY their own notes)
  â†’ User: No access to notes feature
  
Privacy Design:
  âš ï¸ IMPORTANT: Notes are completely private to each user
  â†’ Admins CANNOT see other users' notes in the app
  â†’ Even though RLS allows admin read access, the app never uses it
  â†’ Each user only queries: .eq('user_id', currentUser.id)
  â†’ This ensures student notes remain private and personal

Notes Organization:
  â†’ Grouped by datestamp
  â†’ Single note per date â†’ shown directly
  â†’ Multiple notes per date â†’ shown in folder
  â†’ Sorted by datestamp (descending)
  â†’ Title fallback: First 3 words of content

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
ğŸ” AUTHENTICATION & SECURITY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Authentication Methods:
  âœ… Email/Password (Primary)
  âœ… Google OAuth (Social login)
  âœ… Phone/SMS (Optional - configured but not actively used)

Session Management:
  â†’ Client-side: Supabase Auth handles sessions automatically
  â†’ Storage: In-memory only (NO localStorage/sessionStorage used in app)
  â†’ Listener: auth.onAuthStateChange() tracks auth state changes
  â†’ Session Duration: Follows Supabase default (1 hour access token, 7 day refresh)

OAuth Configuration:
  â†’ Provider: Google
  â†’ Redirect URLs: 
     - Web: window.location.origin
     - Mobile (Capacitor): com.eor.app://oauth
  â†’ Deep Links: Handled via Capacitor App URL listener

Helper Functions (Database):
  â†’ is_admin(): Returns true if auth.uid() has role = 'admin'
     Used in RLS policies for cleaner syntax

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¦ STORAGE BUCKETS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

BUCKET: notices
  Purpose: Store images for activity posts
  Settings:
    â†’ Public: YES (all users can view images)
    â†’ Path Pattern: notices/{timestamp}_{filename}
    â†’ Allowed MIME Types: image/* (PNG, JPG, JPEG, GIF, WebP)
    â†’ Max File Size: Default Supabase limit (50MB)

Storage Policies:
  â†’ Upload: Authenticated users only (via app logic)
  â†’ View: Public (anyone with URL)
  â†’ Delete: Admin only

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ’¾ LOCAL STORAGE KEYS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Application-specific localStorage keys:

1. authState â†’ JSON: { userProfile, isAdmin }
   Purpose: Cache user authentication state for offline access
   
2. notes_{userId} â†’ JSON: Array of note objects
   Purpose: Offline-first notes storage
   
3. notes_lastSync_{userId} â†’ ISO timestamp
   Purpose: Track last cloud sync time
   
4. totalFund â†’ Number (string)
   Purpose: Cache total fund amount
   
5. allFundData â†’ JSON: Array of fund entries
   Purpose: Cache all fund data for offline access
   
6. cachedMonthlyData â†’ JSON: Object with monthly aggregates
   Purpose: Cache monthly fund data
   
7. donorsData â†’ JSON: Array of donor objects
   Purpose: Cache blood donor list
   
8. noticesData â†’ JSON: Array of notice objects
   Purpose: Cache activities/notices
   
9. lang â†’ String: 'en' or 'bn'
   Purpose: Store language preference

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ’¡ IMPORTANT CODING CONVENTIONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. NAMING CONVENTIONS
   âš ï¸ CRITICAL: Always convert between JavaScript and Database naming!
   
   Database (snake_case)     â†â†’     JavaScript (camelCase)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   blood_group               â†â†’     bloodGroup
   user_id                   â†â†’     userId
   author_name              â†â†’     authorName
   created_at               â†â†’     createdAt
   additional_info          â†â†’     additionalInfo

2. USER AUTHENTICATION REFERENCE
   âœ“ Current user object: db.auth.getUser() or session.user
   âœ“ User ID: currentUser.id (NOT currentUser.uid - that's Firebase!)
   âœ“ User email: currentUser.email
   âœ“ Session check: db.auth.getSession()

3. DATABASE QUERIES (Supabase Syntax)
   
   âœ… CORRECT:
   const { data, error } = await db.from('fund').select('*').eq('type', 'income')
   
   âŒ WRONG (Firebase syntax):
   const doc = await db.collection('fund').doc(id).get()

4. TIMESTAMPS
   âœ… CORRECT: new Date().toISOString()
   âŒ WRONG: firebase.firestore.FieldValue.serverTimestamp()
   
   Reading timestamps:
   â†’ new Date(timestamp).toLocaleString()
   â†’ For Bangladesh time: new Date(timestamp + 6*60*60*1000)

5. STORAGE OPERATIONS
   Upload:
     const { data, error } = await db.storage
       .from('notices')
       .upload(path, file)
   
   Get Public URL:
     const { data } = db.storage
       .from('notices')
       .getPublicUrl(path)

6. COMMON ERRORS & SOLUTIONS

   Error: "RLS policy violation"
   â†’ Fix: User doesn't have permission. Check RLS policies in table above.
   
   Error: "Column 'bloodGroup' does not exist"
   â†’ Fix: Use snake_case in queries: .select('blood_group')
   
   Error: "No session found"
   â†’ Fix: User not logged in. Check: await db.auth.getSession()
   
   Error: "Cannot read property 'from' of undefined"
   â†’ Fix: Supabase client not initialized. Check: const db = createClient(...)
   
   Error: "Notes not syncing properly"
   â†’ Fix: Check localStorage key format: `notes_${userId}`
   â†’ Fix: Ensure user is authenticated before syncing
   â†’ Fix: Check if user role allows notes access (student/moderator/admin)
   
   Error: "Admin can see other users' notes" (PRIVACY VIOLATION!)
   â†’ Fix: This should NEVER happen. Always query with:
          .eq('user_id', this.state.currentUser.id)
   â†’ Never query all notes, even for admins

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”§ DEVELOPMENT WORKFLOW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Adding New Features Checklist:

â–¡ 1. Design database schema
     â†’ Decide on table structure and columns
     â†’ Choose appropriate data types
     
â–¡ 2. Create table in Supabase Dashboard
     â†’ Use SQL editor or Table editor
     
â–¡ 3. Enable RLS on new table
     â†’ Dashboard â†’ Table â†’ Settings â†’ Enable RLS
     
â–¡ 4. Create RLS policies
     â†’ SELECT: Who can read data?
     â†’ INSERT: Who can create records?
     â†’ UPDATE: Who can modify records?
     â†’ DELETE: Who can remove records?
     
â–¡ 5. Test policies in Supabase SQL Editor
     â†’ Use auth.uid() = 'test-uuid' to simulate different users
     
â–¡ 6. Update this documentation
     â†’ Add new table schema above
     â†’ Document all policies
     
â–¡ 7. Implement in code
     â†’ Remember snake_case â†â†’ camelCase conversion!
     â†’ Handle {data, error} responses
     
â–¡ 8. Test thoroughly
     â†’ Test as different user roles
     â†’ Test error cases (network failure, permission denied)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š DATABASE SYSTEM TABLES (Auto-generated by Supabase)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

These tables are managed by Supabase. DO NOT modify directly!

auth.* tables:
  â†’ auth.users - Core user authentication data
  â†’ auth.sessions - Active user sessions
  â†’ auth.identities - OAuth provider links
  â†’ auth.refresh_tokens - Token refresh data
  â†’ auth.mfa_factors - Multi-factor authentication
  â†’ auth.audit_log_entries - Authentication audit trail

storage.* tables:
  â†’ storage.buckets - Storage bucket configuration
  â†’ storage.objects - Uploaded files metadata
  â†’ storage.migrations - Storage schema versions

realtime.* tables:
  â†’ realtime.messages - Real-time pub/sub messages
  â†’ realtime.subscription - Active subscriptions

extensions.* tables:
  â†’ pg_stat_statements - PostgreSQL query statistics

vault.* tables:
  â†’ vault.secrets - Encrypted secrets storage

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ QUICK REFERENCE: Common Queries
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Get current user
const { data: { user } } = await db.auth.getUser()

// Check if user is admin
const { data } = await db.from('users').select('role').eq('id', user.id).single()
const isAdmin = data?.role === 'admin'

// Fetch fund data for a month
const { data, error } = await db
  .from('fund')
  .select('*')
  .eq('month', '2025-10')
  .order('timestamp', { ascending: true })

// Add new fund entry (admin only)
const { error } = await db.from('fund').insert({
  month: '2025-10',
  type: 'income',
  name: 'John Doe',
  amount: 1000,
  updated_by: user.id
})

// Get all available blood donors
const { data } = await db
  .from('donors')
  .select('*')
  .eq('available', true)
  .order('name')

// Post new activity (admin only)
const { error } = await db.from('notices').insert({
  text: 'New announcement',
  author_name: userName,
  author_id: user.id
})

// Fetch user's own notes (students, moderators, admins - privacy respected)
const { data } = await db
  .from('notes')
  .select('*')
  .eq('user_id', user.id)
  .order('datestamp', { ascending: false })

// Backup all notes to cloud (overwrites server with local)
// 1. Delete all existing notes
await db.from('notes').delete().eq('user_id', user.id)
// 2. Insert all local notes
await db.from('notes').insert(localNotesArray)

// Save note to localStorage
localStorage.setItem(`notes_${userId}`, JSON.stringify(notesArray))

// Load notes from localStorage
const notes = JSON.parse(localStorage.getItem(`notes_${userId}`) || '[]')

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“ MAINTENANCE NOTES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

When updating this documentation:
  âœ“ Add new tables to "DATABASE SCHEMA - PUBLIC TABLES" section
  âœ“ Document all RLS policies for new tables
  âœ“ Update "Common Queries" section with new use cases
  âœ“ Add new error patterns to "Common Errors & Solutions"
  âœ“ Keep naming conventions consistent
  âœ“ Test all code examples before documenting

Last Updated: October 2025
Supabase Project: kszhmrhlsoqfxkcopvoe
App Version: 1.0

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Remember: This is a vibe coding project. Keep the energy flowing! ğŸµâœ¨   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•